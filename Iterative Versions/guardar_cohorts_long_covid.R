library(DatabaseConnector)
library(CohortDiagnostics)

baseUrl <- "https://atlas-demo.ohdsi.org/WebAPI"
# list of cohort ids
cohortIds <- c(1778995, 1778994, 1778993, 1778992, 1778991, 1778990, 1778989, 1778988, 1778987, 1778986, 1778985, 1778984, 1778983, 1778982, 1778981, 1778980, 1778979, 1778978, 1778976, 1778975, 1778974, 1778973, 1778972, 1778971, 1778970, 1778969, 1778968, 1778967, 1778966, 1778965, 1778964, 1778963, 1778961, 1778959, 1778957, 1778956, 1778955, 1778954, 1778953, 1778940, 1778722, 1778939, 1778723, 1778952, 1778951, 1778950, 1778949, 1778945, 1778948, 1778947, 1778946, 1778944, 1778943, 1778942, 1778724, 1778941, 1778719, 1778938, 1778712, 1778713, 1778937, 1778936, 1778718, 1778935, 1778717, 1778934, 1778716, 1778933, 1778708, 1778932, 1778709, 1778831, 1778707, 1778830, 1778706, 1778829, 1778705, 1778828, 1778704, 1778827, 1778703, 1778826, 1778702, 1778825, 1778824, 1778823, 1778822, 1778821, 1778695, 1778817, 1778820, 1778819, 1778818, 1778816, 1778699, 1778815, 1778814, 1778813, 1778812, 1778811, 1778701, 1778810, 1778809, 1778808, 1778806, 1778805, 1778698, 1778804, 1778803, 1778802, 1778801, 1778800, 1778700, 1778799, 1778798, 1778797, 1778796, 1778795, 1778794, 1778793, 1778792, 1778791, 1778790, 1778789, 1778788, 1778787, 1778785, 1778694, 1778784, 1778783, 1778689, 1778781, 1778779, 1778780, 1778778, 1778777, 1778659, 1778658, 1778776, 1778775, 1778774, 1778773, 1778772, 1778688, 1778771, 1778687, 1778770, 1778686, 1778685, 1778769, 1778768, 1778684, 1778767, 1778681, 1778680, 1778766, 1778765, 1778764, 1778763, 1778762, 1778760, 1778759, 1778758, 1778757, 1778679, 1778756, 1778755, 1778678, 1778754, 1778665, 1778753, 1778677, 1778752, 1778676, 1778751, 1778675, 1778750, 1778674, 1778749, 1778673, 1778748, 1778672, 1778746, 1778747, 1778745, 1778743, 1778742, 1778666, 1778741, 1778667, 1778740, 1778664, 1778738, 1778662, 1778739, 1778663, 1778737, 1778661, 1778660, 1778736)
cohortDefinitionSet <- ROhdsiWebApi::exportCohortDefinitionSet(baseUrl = baseUrl,
                                                               cohortIds = cohortIds,
                                                               generateStats = TRUE)
cohorts.folder <- here::here("Cohorts LongCovid")
if (!file.exists(cohorts.folder)){
  dir.create(cohorts.folder)
}
json.folder <- here::here("Cohorts LongCovid","JSON")
if (!file.exists(json.folder)){
  dir.create(json.folder)
}
sql.folder <- here::here("Cohorts LongCovid","SQL")
if (!file.exists(sql.folder)){
  dir.create(sql.folder)
}

save(cohortDefinitionSet,file=here::here("Cohorts LongCovid","Info_cohorts.RData"))

for (k in 1:nrow(cohortDefinitionSet)){
fileConn<-file(paste0(cohortDefinitionSet$cohortName[k],".json"))
writeLines(cohortDefinitionSet$json[k], fileConn)
close(fileConn)
}